import{d as M,y as P,z as R,r as i,B as N,ac as O,aj as S,ak as U,a as E,w as t,V as L,ah as H,o as z,b as o,f,a8 as A,i as r,j as C,e as y,g as V,h as x,_ as W}from"./index-0aa53c24.js";const q=["width","height"],F=["width","height"],G=M({__name:"PhotoCapture",emits:["no-capture"],setup(J,{emit:w}){const k=w,h=H(),B=P(),{temporaryProfilePicture:D}=R(B),p=i(""),d=i([]),c=i(320),n=i(320),a=i(null),_=i(null);let m=!1,s=null,l=null;N(()=>{console.debug("On mounted...",a.value),s==null||s.getTracks().forEach(e=>{console.debug("Media track",e),e.stop()}),navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(e=>(console.debug("Media stream",s),s=e,a.value.srcObject=s,l=s.getVideoTracks()[0],a.value.play(),console.debug("Devs",navigator.mediaDevices),navigator.mediaDevices.enumerateDevices())).then(e=>{d.value=e.filter(u=>u.kind==="videoinput"),console.debug("Media devices",d.value),d.value.length>0,a.value.addEventListener("canplay",u=>{m||(n.value=a.value.videoHeight/(a.value.videoWidth/c.value),isNaN(n.value)&&(n.value=c.value*3/4),m=!0)})}).catch(e=>{O.fire("show-alert",{key:"Media device error"+e.message,type:"error"})})}),S(()=>{l==null||l.stop(),a.value&&(a.value.srcObject=null)}),U((e,u)=>(console.debug("Before route leave",e),l==null||l.stop(),a.value&&(a.value.srcObject=null),!0));function g(){l==null||l.stop(),a.value.srcObject=null,m=!1}function j(){var v,b;const e=(v=_.value)==null?void 0:v.getContext("2d");e==null||e.drawImage(a.value,0,0,c.value,n.value);const u=(b=_.value)==null?void 0:b.toDataURL("image/png");u&&(g(),D.value=u),h.push({name:"PhotoCropper"})}function I(){g(),k("no-capture",{}),h.back()}return(e,u)=>(z(),E(L,null,{default:t(()=>[o(y,{class:"flex-column",align:"center"},{default:t(()=>[o(f,null,{default:t(()=>[o(A,{modelValue:p.value,"onUpdate:modelValue":u[0]||(u[0]=v=>p.value=v),label:"Select Camera",items:d.value,"item-text":"label","item-value":"deviceId"},null,8,["modelValue","items"])],void 0,!0),_:1}),o(f,{cols:"auto"},{default:t(()=>[r(" Video "),C("video",{ref_key:"video",ref:a,style:{border:"1px solid red"},width:c.value,height:n.value},null,8,q),r(" Canvas "),C("canvas",{id:"canvas",ref_key:"canvas",ref:_,width:c.value,height:n.value,style:{border:"1px solid red"}},null,8,F)],void 0,!0),_:1}),o(y,{justify:"end"},{default:t(()=>[o(f,{cols:"auto"},{default:t(()=>[o(V,{onClick:j},{default:t(()=>[o(x,{left:"",color:"primary"},{default:t(()=>[r("mdi-check")],void 0,!0),_:1}),r(" Use Image ")],void 0,!0),_:1})],void 0,!0),_:1}),o(f,{cols:"auto"},{default:t(()=>[o(V,{onClick:I},{default:t(()=>[o(x,{left:"",color:"secondary"},{default:t(()=>[r("mdi-close")],void 0,!0),_:1}),r(" Cancel ")],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0,!0),_:1})],void 0),_:1}))}});const Q=W(G,[["__scopeId","data-v-e10cc84c"]]);export{Q as default};
